import shapefile
import geopandas as gp
import matplotlib.pyplot as plt
import rasterio
import rasterio.plot
from rasterio.mask import mask
import pycrs
from rasterio.plot import show
from rasterio.plot import show_hist
import numpy as np
import pandas as pd
import csv

# sf = shapefile.Reader("C:/Users/Agus/Desktop/usar_este/incendios.shp")
# sfnqn = shapefile.Reader("C:/Users/Agus/Desktop/shp_prov/NQN/clas_mer_BAP_continental_modentr_vf_nqn.shp")

incendios = gp.GeoDataFrame.from_file("C:/Users/Agus/Desktop/usar_este/poligono.shp")
provincias = gp.GeoDataFrame.from_file("C:/Users/Agus/Desktop/shp_prov/NQN/clas_mer_BAP_continental_modentr_vf_nqn.shp")

incendios[incendios.geometry.intersects(provincias)]
poly = provincias.geometry.unary_union
test_clip = incendioa[incendios.geometry.intersects(poly)]
points_clip = cl.clip_shp(incendios, provincias)


fig, ax = plt.subplots(figsize=(12, 8))
provincias.plot(alpha=1,
                color="white",
                edgecolor="black",
                ax=ax)
incendios.plot(cmap='Greys',
               ax=ax,
               alpha=.5)
points_clip.plot(ax=ax,
                 column='name')
ax.set_axis_off()
plt.axis('equal')



# data

# for indice, prov in provincias.iterrows():
#     for indice2,inc in incendios.iterrows():
#         if prov['geometry'].intersects(inc['geometry']):
#             data.append({'geometry':prov['geometry'].intersection(inc['geometry']),'id1':indice, 'id2':indice2 , 'Shape_Leng':inc['Shape_Leng'], 'Shape_Area':inc['Shape_Area'], 'fecha':inc['fecha'], 'area_ha':inc['area_ha'], 'Ley_N1':prov['Ley_N1'], 'Ley_N2':prov['Ley_N2'], 'Ley_N3':prov['Ley_N3'], 'PN':prov['PN']})
            
# print(data)            
# prov_inc = gp.GeoDataFrame(data,columns=['geometry','Shape_Leng','Shape_Area','fecha','area_ha','Ley_N1','Ley_N2','Ley_N3','PN'])
# #prov_inc.to_file('C:/Users/Agus/Desktop/usar_este/test.shp',driver ='ESRI Shapefile')
# prov_inc.to_csv('C:/Users/Agus/Desktop/usar_este/test.csv', header=True, index=True)
